/*! For license information please see main.f0086b7b.chunk.js.LICENSE.txt */
(this["webpackJsonpreact-battleships"]=this["webpackJsonpreact-battleships"]||[]).push([[0],{21:function(n,e,t){},27:function(n,e,t){"use strict";t.r(e);var r=t(1),i=t.n(r),o=t(13),c=t.n(o),a=(t(21),t(4)),s=t(5);function u(n){return d(n)}function d(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=function(e){return e.x<0||e.x>n-1||e.y<0||e.y>n-1},i=function(n){return e.some((function(e){return e.getBoardSpaceCoords().some((function(e){return e.equals(n)}))}))},o=function(n){return t.some((function(e){return e.equals(n)}))},c=function(n){return e.some((function(e){return e.hits.some((function(e){return e.equals(n)}))}))},a=function(){return e.reduce((function(n,e){return[].concat(Object(s.a)(n),Object(s.a)(e.hits))}),[])},u=function(n){return n.getBoardSpaceCoords().every((function(n){return!r(n)&&!i(n)}))},l=function(n){return!r(n)&&!o(n)&&!c(n)},h=function(r){if(!u(r))throw new Error("Tried to add ship at illegal board position ".concat(r.getBoardSpaceCoords().map((function(n){return"(".concat(n.x,",").concat(n.y,")")}))));return d(n,[].concat(Object(s.a)(e),[r]),t)},f=function(r){return r.reduce((function(n,e){return n.addShip(e)}),d(n,e,t))},j=function(i){if(r(i))throw new Error("Tried to receive hit at illegal position (".concat(i.x,", ").concat(i.y,")"));var o=e.find((function(n){return n.getBoardSpaceCoords().some((function(n){return n.equals(i)}))}));if(o){var c=o.getBoardSpaceCoords().findIndex((function(n){return n.equals(i)})),a=o.hit(c),u=e.map((function(n){return n===o?a:n}));return d(n,u,t)}var l=[].concat(Object(s.a)(t),[i]);return d(n,e,l)},b=function(){return e.every((function(n){return n.isSunk()}))};return{size:n,ships:e,misses:t,get hits(){return a()},addShip:h,addShips:f,receiveHit:j,isEveryShipSunk:b,isValidShip:u,isValidMovePos:l}}var l,h,f,j,b=t(2),p=t(3),g=p.a.div(l||(l=Object(b.a)(["\n  grid-column: ",";\n  grid-row: ",";\n"])),(function(n){return n.pos.x+1}),(function(n){return n.pos.y+1})),O=Object(p.a)(g)(h||(h=Object(b.a)(["\n  background-color: green;\n  border-radius: 50%;\n  opacity: 50%;\n"]))),x=Object(p.a)(g)(f||(f=Object(b.a)(["\n  background-color: red;\n  border-radius: 50%;\n  opacity: 50%;\n"]))),v=t(0);function m(n){var e=n.hits,t=n.misses,r=function(n){return"(".concat(n.x,", ").concat(n.y,")")};return Object(v.jsxs)(v.Fragment,{children:[e.map((function(n){return Object(v.jsx)(O,{pos:n},r(n))})),t.map((function(n){return Object(v.jsx)(x,{pos:n},r(n))}))]})}var y,S=p.a.div(j||(j=Object(b.a)(["\n  /* TODO: query screen width to set cell size */\n  --container-size: 20rem;\n  --cell-size: ",";\n\n  /* box-sizing: border-box; */\n  display: grid;\n  grid-template-columns: repeat(",", var(--cell-size));\n  grid-template-rows: repeat(",", var(--cell-size));\n\n  max-width: var(--container-size);\n\n  border: 1px solid black;\n\n  > .grid-bg {\n    border: 1px solid black;\n    text-align: center;\n    cursor: pointer;\n  }\n"])),(function(n){var e=n.size;return"calc(var(--container-size)/".concat(e,")")}),(function(n){return n.size}),(function(n){return n.size})),w=p.a.div(y||(y=Object(b.a)(["\n  user-select: none;\n  grid-column: ",";\n  grid-row: ",";\n\n  :hover {\n    background: lightgrey;\n  }\n"])),(function(n){return n.position.x+1}),(function(n){return n.position.y+1})),C=t(6),k=function n(e,t){var r=function(n){return null!=n.x&&null!=n.y};return Object.freeze({x:e,y:t,equals:function(n){return n.x===e&&n.y===t},add:function(i){return r(i)?n(e+i.x,t+i.y):n(e+i,t+i)},multiply:function(i){return r(i)?n(e*i.x,t*i.y):n(e*i,t*i)}})},z=Object.freeze({up:k(0,-1),right:k(1,0),down:k(0,1),left:k(-1,0)}),M=[z.up,z.right,z.down,z.left],E=Object.freeze(Object(C.a)(Object(C.a)({},z),{},{indexed:M,increment:function(n,e){return M[(M.findIndex((function(e){return e.equals(n)}))+e)%M.length]}})),P=k;function B(n){var e=n.onCellClick,t=void 0===e?function(){}:e,r=n.onCellMouseEnter,i=void 0===r?function(){}:r,o=n.gameboard,c=n.children;return Object(v.jsxs)(S,{size:o.size,children:[function(){for(var n=[],e=0;e<o.size;e++)for(var r=function(r){var c=P(r,e);n.push(Object(v.jsxs)(w,{onClick:function(){return t(c)},onMouseEnter:function(){return i(c)},className:"grid-bg",position:c,children:["ABCDEFGHIJKLMNOP".split("")[e],r+1]},r+e*o.size))},c=0;c<o.size;c++)r(c);return n}(),c]})}function T(n){var e=n.gameboard,t=n.setGameboard,r=n.onAttack;return Object(v.jsx)("div",{children:Object(v.jsx)(B,{gameboard:e,onCellClick:function(n){e.isValidMovePos(n)&&(t((function(e){return e.receiveHit(n)})),r())},children:Object(v.jsx)(m,{misses:e.misses,hits:e.hits})})})}function A(n,e,t){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Array(n).fill(!1),i=function(){return r.reduce((function(n,e,t){return e?[].concat(Object(s.a)(n),[o(t)]):n}),[])},o=function(n){return t.multiply(n).add(e)},c=function(){for(var e=[],t=0;t<n;t++)e.push(o(t));return e},a=function(i){if(i>n-1||i<0)throw new Error("Tried to hit a ship at illegal position ".concat(i));var o=Object(s.a)(r);return o[i]=!0,A(n,e,t,o)},u=function(){return!r.includes(!1)};return{length:n,origin:e,rotation:t,get hits(){return i()},hit:a,isSunk:u,getBoardSpaceCoords:c}}var V,q=function(n){var e;do{e=P(Math.floor(Math.random()*n.size),Math.floor(Math.random()*n.size))}while(!n.isValidMovePos(e));return e},H=function(n){var e,t=n.ships.find((function(n){return n.hits.length>0&&!n.isSunk()}));if(!t)return q(n);if(1===t.hits.length){var r=(e=t.hits[0],E.indexed.map((function(n){return e.add(n)}))).filter(n.isValidMovePos);if(r.length>0)return r[Math.floor(Math.random()*r.length)]}else if(t.hits.length>1){var i=[t.hits[0].add(t.rotation.multiply(P(-1,-1))),t.hits[t.hits.length-1].add(t.rotation)].filter(n.isValidMovePos);if(i.length>0)return i[Math.floor(Math.random()*i.length)]}return q(n)},I=function(n,e){if(n.size<e)throw new Error("Cannot get valid ship of length ".concat(e," from board of length ").concat(n.size));var t,r=0;do{t=A(e,q(n),E.indexed[Math.floor(Math.random()*E.indexed.length)]),r++}while(!n.isValidShip(t)&&r<999);if(!(r>=999))return t;console.log("Could not find valid position to place ship! There are likely not enough free positions on the board")},N=function(n){for(var e=n,t=[5,4,3,3,2],r=[],i=0;i<t.length;i++){var o=I(e,t[i]);r.push(o),e=e.addShip(o)}return r};function F(n){var e=n.ship,t=n.customStyle,r=void 0===t?{background:"grey",border:"1px solid black"}:t;return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)("div",{style:Object(C.a)(Object(C.a)(Object(C.a)(Object(C.a)({},r),e.isSunk()?{background:"red"}:{}),function(){var n=e.rotation.x>=0?e.origin.x+1:Math.max(1,e.origin.x-e.length+2),t=e.rotation.y>=0?e.origin.y+1:Math.max(1,e.origin.y-e.length+2),r=function(n,t){return 0===n?1:n>0?e.length:Math.min(t+1,e.length)},i=r(e.rotation.x,e.origin.x),o=r(e.rotation.y,e.origin.y);return{gridColumn:"".concat(n," / span ").concat(i),gridRow:"".concat(t," / span ").concat(o)}}()),{},{pointerEvents:"none"})}),Object(v.jsx)("div",{style:{gridColumn:e.origin.x+1,gridRow:e.origin.y+1,pointerEvents:"none",userSelect:"none"},children:"X"})]})}function G(n){var e=n.ships;return Object(v.jsx)(v.Fragment,{children:e.map((function(n){return Object(v.jsx)(F,{ship:n},"(".concat(n.origin.x,", ").concat(n.origin.y,")"))}))})}var R=p.a.div(V||(V=Object(b.a)(["\n  flex-direction: column;\n  align-items: center;\n  text-align: center;\n  @media (min-width: 48rem) {\n    width: 48em;\n    display: flex;\n    flex-direction: row;\n    justify-content: space-around;\n  }\n"])));var D=function(n){var e=n.useBoardPlayer,t=n.useBoardNpc,i=n.onGameOver,o=Object(a.a)(e,2),c=o[0],s=o[1],u=Object(a.a)(t,2),d=u[0],l=u[1],h=Object(r.useState)(0),f=Object(a.a)(h,2),j=f[0],b=f[1];Object(r.useEffect)((function(){d.isEveryShipSunk()?i("Player"):c.isEveryShipSunk()&&i("NPC")}),[c,d,i]);var p=function(n){return n.ships.reduce((function(n,e){return e.isSunk()?n-1:n}),n.ships.length)};return Object(v.jsxs)("div",{style:{textAlign:"center"},children:[Object(v.jsxs)("div",{children:["Turn: ",j]}),Object(v.jsxs)(R,{children:[Object(v.jsxs)("div",{children:[Object(v.jsx)("h2",{children:"Enemy board"}),Object(v.jsx)(T,{gameboard:d,setGameboard:l,onAttack:function(){s((function(n){return n.receiveHit(H(n))})),b((function(n){return n+1}))}}),Object(v.jsxs)("p",{children:["Enemy ships remaining: ",p(d)]})]}),Object(v.jsxs)("div",{children:[Object(v.jsx)("h2",{children:"Player board"}),Object(v.jsxs)(B,{gameboard:c,children:[Object(v.jsx)(m,{hits:c.hits,misses:c.misses}),Object(v.jsx)(G,{ships:c.ships})]}),Object(v.jsxs)("p",{children:["Player ships remaining: ",p(c)]})]})]})]})};function J(n){var e=n.ship,t=n.isValidPos;return Object(v.jsx)(F,{ship:e,customStyle:{opacity:"50%",backgroundColor:t?"green":"red"}})}function L(n){var e=n.useBoard,t=n.onAllShipsPlaced,i=[5,4,3,3,2],o=Object(r.useState)(0),c=Object(a.a)(o,2),s=c[0],u=c[1],d=Object(r.useState)(A(i[s],P(-10,-10),E.right)),l=Object(a.a)(d,2),h=l[0],f=l[1],j=Object(a.a)(e,2),b=j[0],p=j[1],g=function(n,e){return A(n.length,e,n.rotation)},O=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return A(n.length,n.origin,E.increment(n.rotation,e))},x=function(n){return e[0].isValidShip(n)};return Object(v.jsxs)("div",{children:[Object(v.jsx)("h2",{children:"Place your ships!"}),Object(v.jsx)("div",{onWheel:function(n){return n.deltaY>0?f((function(n){return O(n)})):f((function(n){return O(n,3)}))},children:Object(v.jsxs)(B,{gameboard:b,onCellMouseEnter:function(n){f((function(e){return g(e,n)}))},onCellClick:function(n){var e=g(h,n);x(e)?(p((function(n){return n.addShip(e)})),s<i.length-1?(f(A(i[s+1],n,e.rotation)),u((function(n){return n+1}))):t()):console.log("Oops! Can't place ship there!")},children:[Object(v.jsx)(J,{ship:h,isValidPos:x(h)}),Object(v.jsx)(G,{ships:b.ships})]})}),Object(v.jsx)("button",{onClick:function(){return f((function(n){return O(n)}))},children:"Rotate"}),Object(v.jsx)("p",{children:"Rotate with scroll wheel"})]})}function Y(n){var e=n.onContinue;return Object(v.jsxs)("div",{children:[Object(v.jsx)("h2",{children:"How to play"}),Object(v.jsx)("p",{children:"Battleship is a strategic guessing game."}),Object(v.jsx)("p",{children:"Try to figure out where the enemy ships are hiding, and sink their fleet before they can sink yours!"}),Object(v.jsx)("button",{onClick:e,children:"Continue"})]})}var K="rules",U="setup",W="main",X="game over";function Q(){var n=Object(r.useState)((function(){return u(10)})),e=Object(r.useState)((function(){return u(10).addShips(N(u(10)))})),t=Object(r.useState)({mode:K}),i=Object(a.a)(t,2),o=i[0],c=i[1],s=function(n){c({mode:X,winner:n})},d=function(){return Object(v.jsxs)(v.Fragment,{children:["Player"===o.winner?Object(v.jsxs)("h2",{children:["Congratulations, ",o.winner,"! You won!"]}):Object(v.jsxs)("h2",{children:["Too bad! ",o.winner," beat you!"]}),Object(v.jsx)("button",{onClick:function(){return function(){var t=Object(a.a)(n,2)[1],r=Object(a.a)(e,2)[1];t(u(10)),r(u(10).addShips(N(u(10)))),c({mode:U})}()},children:"Play again?"})]})};return Object(v.jsxs)("div",{className:"App",style:{padding:"2rem",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[Object(v.jsx)("h1",{children:"REACT-BATTLESHIP"}),function(t){switch(t){case K:return Object(v.jsx)(Y,{onContinue:function(){return c({mode:U})}});case W:return Object(v.jsx)(D,{useBoardPlayer:n,useBoardNpc:e,onGameOver:s});case U:return Object(v.jsx)(L,{useBoard:n,onAllShipsPlaced:function(){return c({mode:W})}});case X:return d();default:throw new Error("Unhandled game mode: ".concat(t,"!"))}}(o.mode)]})}c.a.render(Object(v.jsx)(i.a.StrictMode,{children:Object(v.jsx)(Q,{})}),document.getElementById("root"))}},[[27,1,2]]]);
//# sourceMappingURL=main.f0086b7b.chunk.js.map